üì¶ –¶–µ–ª—å
–ü—Ä–∏ –≤—ã–∑–æ–≤–µ —Å–∫—Ä–∏–ø—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:


python3 main.py sources/multiply_import.py --output result/
–≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –≤–Ω—É—Ç—Ä–∏ multiply_import.py –∏ –≤—Å–µ—Ö –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –±—É–¥—É—Ç –ø–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω—ã –≤ –¥–µ—Ä–µ–≤–æ, –∏ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã —Ç–∞–∫, —á—Ç–æ–±—ã:

–∫–æ—Ä–Ω–µ–º –±—ã–ª result/

–∏–º–ø–æ—Ä—Ç—ã —É–∫–∞–∑—ã–≤–∞–ª–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ .py-—Ñ–∞–π–ª—ã, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ result/

üìå –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
1. –†–∞—Å—à–∏—Ä–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã CLI (main.py)
–î–æ–±–∞–≤–∏—Ç—å:


parser.add_argument('--output', type=str, required=True, help='Output directory')
2. –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å result_dir_path –≤ PythonVisitor

visitor = PythonVisitor(module=os.path.abspath(infile.name),
                        result_dir_path=args.output,
                        rebuild_imports_tree=True)
3. –û–±–Ω–æ–≤–∏—Ç—å visit_ImportFrom –∏ visit_Import
–í visit_ImportFrom():

–†–∞–∑–±–∏—Ç—å node.module –Ω–∞ —á–∞—Å—Ç–∏: sources.first_level_package...

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—É—Ç—å:


path = os.path.join(self.result_dir_name, *node.module.split("."))
–°–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∞–ø–∫–∏ –∏ __init__.py —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ rebuild_imports_tree=True)

–í–µ—Ä–Ω—É—Ç—å —Å—Ç—Ä–æ–∫—É:


from result.sources.first_level_package... import X
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–ª–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
–ù–∞–π—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π .py-—Ñ–∞–π–ª –∏–∑ sys.path –∏–ª–∏ PYTHONPATH

–†–∞—Å–ø–∞—Ä—Å–∏—Ç—å –µ–≥–æ ast.parse

–†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å visitor.transpile() –Ω–∞ –Ω–µ–≥–æ

–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –≤ result_dir_path

5. –í–∫–ª—é—á–∞—Ç—å __init__.py
–í –∫–∞–∂–¥–æ–π –ø–∞–ø–∫–µ, —Å–æ–∑–¥–∞–Ω–Ω–æ–π –≤ result_dir_path, —Å–æ–∑–¥–∞—Ç—å __init__.py

–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–∫–µ—Ç–∞ Python

6. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
–î–æ–±–∞–≤–∏—Ç—å –∫–µ—à —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ

